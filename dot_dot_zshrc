# By default Zit installs all modules on $HOME for compatibility purposes.
# However, to maintain everything organized it is better to set a dedicated
# directory for Zit modules.
NORMAL_ZIT_MODULES_PATH="${HOME}/.zsh-modules";
export ZIT_MODULES_PATH=$NORMAL_ZIT_MODULES_PATH;



if [ -e '/nix/var/nix/profiles/default/etc/profile.d/nix-daemon.sh' ]; then
  source "/nix/var/nix/profiles/default/etc/profile.d/nix-daemon.sh";
fi

if [ -e '$HOME/.nix-profile/etc/profile.d/nix.sh' ]; then
  source "$HOME/.nix-profile/etc/profile.d/nix.sh";
fi
export NIX_PATH=$HOME/.nix-defexpr/channels${NIX_PATH:+:}$NIX_PATH;

source "$HOME/.nix-profile/etc/profile.d/hm-session-vars.sh";

# If Zit is not found, clone it
if [[ ! -d "${ZIT_MODULES_PATH}/zit" ]]; then
  git clone "https://github.com/thiagokokada/zit" "${ZIT_MODULES_PATH}/zit";
fi

# Source Zit file
source "${ZIT_MODULES_PATH}/zit/zit.zsh";

zit-install-load "https://github.com/romkatv/powerlevel10k.git" "powerline10k" "powerlevel10k.zsh-theme";

neofetch;

#If chosen roles have not been set up yet run the selector and then add the environment vars for roles.
if [[ ! -f ~/.config/roles/chosen/CHEZMOI_ROLL_NULL ]]; then
  . ~/.config/roles/role_selector.zsh;
fi
source ~/.config/roles/role_environment_apply.zsh # I am not moving this into home-manager controlled dotfiles. Remove this once I am fully converted over to having nix control the roles

# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh";
fi

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh;

zit-install-load "https://github.com/marlonrichert/zsh-autocomplete.git#main" "zsh-autocomplete" "zsh-autocomplete.plugin.zsh";
zit-install-load "https://github.com/peterhurford/git-it-on.zsh" "git-it-on" "git-it-on.plugin.zsh";
zit-install-load "https://github.com/zdharma/fast-syntax-highlighting" "fast-syntax-highlighting" "fast-syntax-highlighting.plugin.zsh";

source ~/.aliases;

#Run any zit commands that are not in the normal zit install dir below.
ZIT_MODULES_PATH="$HOME";
for file in ~/.functions/*.zsh; do
   zit-load ".functions" "$file:t";
done;

# Re-set the zit modules path and enable plugin compilation
ZIT_MODULES_PATH=$NORMAL_ZIT_MODULES_PATH;
zit-load "zit" "extras/compile-zsh-files.zsh";
